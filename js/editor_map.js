// 1 block = 16x10
blockTemplate = [
	[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0], // 0
	[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0], // 1
	[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0], // 2
	[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0], // 3
	[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0], // 4
	[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0], // 5
	[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0], // 6
	[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0], // 7
	[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0], // 8
	[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1] // 9
	];
block0 = [
	[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0], // 0
	[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0], // 1
	[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0], // 2
	[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0], // 3
	[1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0], // 4
	[1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0], // 5
	[1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0], // 6
	[1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0], // 7
	[1,1,1,1,2,0,0,0,0,0,0,0,0,0,0,0], // 8
	[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1] // 9
	];
block1 = [
	[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0], // 0
	[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0], // 1
	[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0], // 2
	[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0], // 3
	[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0], // 4
	[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0], // 5
	[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0], // 6
	[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0], // 7
	[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0], // 8
	[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1] // 9
	];
block2 = [
	[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0], // 0
	[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0], // 1
	[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0], // 2
	[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0], // 3
	[0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1], // 4
	[0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1], // 5
	[0,0,0,0,1,1,1,1,1,1,1,0,0,0,0,0], // 6
	[0,0,1,1,1,1,0,0,0,0,1,0,0,0,0,0], // 7
	[1,1,1,1,1,1,0,0,0,0,1,0,0,0,0,0], // 8
	[1,1,1,1,1,1,0,0,0,0,1,1,1,1,1,1] // 9
	];
block3 = [
	[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0], // 0
	[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0], // 1
	[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0], // 2
	[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0], // 3
	[1,1,1,0,0,0,1,1,1,1,0,0,1,1,1,0], // 4
	[1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0], // 5
	[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0], // 6
	[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0], // 7
	[0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0], // 8
	[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1] // 9
	];
block4 = [
	[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0], // 0
	[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0], // 1
	[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0], // 2
	[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0], // 3
	[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0], // 4
	[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0], // 5
	[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0], // 6
	[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0], // 7
	[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0], // 8
	[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1] // 9
	];


function zoom(){
  if ( keysDown['minus'] || keysDown['minus1'] ){
    var now = Date.now();
    if ( game.tileSize > 16 && now > game.zoomTimer+100){
      game.tileSize = game.tileSize/1.1;
      game.zoomTimer = now;
      delete keysDown['minus'];
      delete keysDown['minus1'];
      for (var i=0; i<game.platforms.length; i++){ game.platforms[i].init(); }
    }
  } else if ( keysDown['plus'] || keysDown['plus1']){
    var now = Date.now();
    if ( game.tileSize < 256 && now > game.zoomTimer+100){
      game.tileSize = game.tileSize*1.1;
      game.zoomTimer = now;
      delete keysDown['plus'];
      delete keysDown['plus1'];
      for (var i=0; i<game.platforms.length; i++){ game.platforms[i].init(); }
    }
  }
}

function Grid(blockSize, chunks, blocksUp, blocksAcross){
  this.x = 0;
  this.y = 0;
  this.last = { x: 0, y: 0 };
  this.chunks = chunks;
  this.blocksUp = blocksUp;
  this.blocksAcross = blocksAcross;
  this.removeFromWorld = false;
  this.update = function(){};
  this.draw = function(ctx){
    var mapWidth = game.tileSize * this.blocksAcross * this.chunks;
    var mapHeight = game.tileSize * this.blocksUp;
    for (var i=0; i < this.blocksUp+1; i++){
      ctx.strokeStyle = '#222';
      ctx.lineWidth = 0.5;
      ctx.beginPath();
      ctx.moveTo(0, game.tileSize * i);
      ctx.lineTo(this.chunks * this.blocksAcross * game.tileSize, game.tileSize * i);
      ctx.closePath();
      ctx.stroke();
    }
    for (var i=0; i < this.chunks*this.blocksAcross+1; i++){
      ctx.strokeStyle = '#222';
      ctx.lineWidth = 0.5;
      ctx.beginPath();
      ctx.moveTo(game.tileSize * i, 0);
      ctx.lineTo(game.tileSize * i, game.tileSize * 10);
      ctx.closePath();
      ctx.stroke();
    }
    drawUI();
  };
}

var templateMap = [ block0,block1,block2,block3,block4 ];

function createMap(){
  var map = game.map;
	var mapWidth = map[0][0].length;
	for (var chunk=0; chunk<map.length; chunk++){
		for (var y=0; y<map[0].length; y++){
			for (var x=0; x<map[0][0].length; x++){
				switch( map[chunk][y][x] ){
					case 1:
						platformEngine.add( new Tiles(x, y, chunk, game.tileSize, mapWidth) );
						break;
					case 2:
						platformEngine.add( new Spring(x, y, chunk, game.tileSize, mapWidth) );
						break;
				}
			}
		}
	}
}

function getMap(){
  var m = templateMap;
  if ( !localStorage.map ){
    storage.set('map', m);
  }
  return storage.get('map');
}